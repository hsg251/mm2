-- Các tham số có thể thay đổi
local player = game.Players.LocalPlayer
local mouse = player:GetMouse()
local farmSpeed = 30          -- Tốc độ di chuyển (sử dụng tốc độ này để bay đến coin)
local autoFarmEnabled = true  -- Bật/tắt chế độ auto farm coin
local resetWhenFull = true    -- Tự động reset khi đầy coin

-- Tạo GUI (giao diện người dùng) với nhãn "ThanhDan Hub"
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player.PlayerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 300, 0, 200)
frame.Position = UDim2.new(0, 10, 0, 10)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.Parent = screenGui

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 50)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
titleLabel.Text = "ThanhDan Hub"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 20
titleLabel.TextAlign = Enum.TextAlign.Center
titleLabel.Parent = frame

local toggleAutoFarmButton = Instance.new("TextButton")
toggleAutoFarmButton.Size = UDim2.new(1, 0, 0, 50)
toggleAutoFarmButton.Position = UDim2.new(0, 0, 0, 60)
toggleAutoFarmButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
toggleAutoFarmButton.Text = "Bật Auto Farm Coin"
toggleAutoFarmButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleAutoFarmButton.TextSize = 18
toggleAutoFarmButton.Parent = frame

local speedSliderLabel = Instance.new("TextLabel")
speedSliderLabel.Size = UDim2.new(1, 0, 0, 50)
speedSliderLabel.Position = UDim2.new(0, 0, 0, 120)
speedSliderLabel.Text = "Tốc độ: " .. tostring(farmSpeed)
speedSliderLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
speedSliderLabel.TextSize = 18
speedSliderLabel.Parent = frame

local resetCoinButton = Instance.new("TextButton")
resetCoinButton.Size = UDim2.new(1, 0, 0, 50)
resetCoinButton.Position = UDim2.new(0, 0, 0, 180)
resetCoinButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
resetCoinButton.Text = "Reset khi đầy Coin"
resetCoinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
resetCoinButton.TextSize = 18
resetCoinButton.Parent = frame

-- Tạo TweenService để thay đổi màu chữ
local TweenService = game:GetService("TweenService")

-- Hàm thay đổi màu chữ
local function changeTextColor()
    while true do
        -- Tạo một Tween để thay đổi màu chữ
        local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, -1, true)
        local goal = {TextColor3 = Color3.fromRGB(math.random(0,255), math.random(0,255), math.random(0,255))}
        local tween = TweenService:Create(titleLabel, tweenInfo, goal)
        
        -- Chạy tween
        tween:Play()
        
        -- Chờ đến khi tween hoàn thành (1 giây)
        wait(1)
    end
end

-- Bắt đầu thay đổi màu chữ
changeTextColor()

-- Tạo sự kiện bật/tắt Auto Farm
toggleAutoFarmButton.MouseButton1Click:Connect(function()
    autoFarmEnabled = not autoFarmEnabled
    if autoFarmEnabled then
        toggleAutoFarmButton.Text = "Tắt Auto Farm Coin"
        print("Auto farm coin đã bật.")
    else
        toggleAutoFarmButton.Text = "Bật Auto Farm Coin"
        print("Auto farm coin đã tắt.")
    end
end)

-- Tạo sự kiện điều chỉnh tốc độ farm
speedSliderLabel.MouseButton1Click:Connect(function()
    farmSpeed = farmSpeed + 10
    if farmSpeed > 45 then
        -- Hiển thị thông báo cảnh báo khi tốc độ quá 45
        local warningLabel = Instance.new("TextLabel")
        warningLabel.Size = UDim2.new(0, 300, 0, 50)
        warningLabel.Position = UDim2.new(0, 10, 0, 250)
        warningLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 0)
        warningLabel.Text = "Tốc độ quá cao! Bạn có thể sẽ bị kick."
        warningLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        warningLabel.TextSize = 20
        warningLabel.TextAlign = Enum.TextAlign.Center
        warningLabel.Parent = screenGui

        wait(3)  -- Hiển thị cảnh báo trong 3 giây
        warningLabel:Destroy()
    end

    if farmSpeed > 100 then
        farmSpeed = 30
    end
    speedSliderLabel.Text = "Tốc độ: " .. tostring(farmSpeed)
    print("Tốc độ farm thay đổi: " .. tostring(farmSpeed))
end)

-- Tạo sự kiện reset coin khi đầy
resetCoinButton.MouseButton1Click:Connect(function()
    resetWhenFull = not resetWhenFull
    if resetWhenFull then
        resetCoinButton.Text = "Tắt Reset khi đầy Coin"
        print("Chế độ reset khi đầy coin đã bật.")
    else
        resetCoinButton.Text = "Bật Reset khi đầy Coin"
        print("Chế độ reset khi đầy coin đã tắt.")
    end
end)

-- Hàm tìm coin trong game
local function findCoin()
    local coins = {}
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj.Name == "Coin" and obj:IsA("Part") then
            table.insert(coins, obj)
        end
    end
    return coins
end

-- Hàm di chuyển đến coin gần nhất
local function moveToCoin(coin)
    if not coin then return end
    local targetPosition = coin.Position
    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local humanoidRootPart = character.HumanoidRootPart
        local direction = (targetPosition - humanoidRootPart.Position).unit
        humanoidRootPart.Velocity = direction * farmSpeed
    end
end

-- Hàm kiểm tra số coin và reset khi đạt 40 coin
local function checkCoinLimit()
    if player.Coins >= 40 then  -- Đổi giới hạn từ 100 sang 40
        -- Reset lại số coin
        player.Coins = 0
        print("Đã reset số coin vì đã đạt 40 coin.")
    end
end

-- Hàm tự động farm coin
local function autoFarmLoop()
    while autoFarmEnabled do
        local coins = findCoin()
        if #coins > 0 then
            local closestCoin = coins[1]
            for _, coin in pairs(coins) do
                if (coin.Position - player.Character.HumanoidRootPart.Position).Magnitude < (closestCoin.Position - player.Character.HumanoidRootPart.Position).Magnitude then
                    closestCoin = coin
                end
            end
            moveToCoin(closestCoin)
        end
        checkCoinLimit()  -- Kiểm tra và reset coin khi đầy
        wait(0.5)
    end
end

-- Bắt đầu quá trình auto farm
autoFarmLoop()
